<Window x:Class="StsModAssist.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="图片裁剪工具" Height="800" Width="1100" Background="#1E1E1E" WindowStartupLocation="CenterScreen" Icon="Resources/app.ico">
    <Window.Resources>
        <!-- 棋盘格画刷定义 -->
        <DrawingBrush x:Key="CheckeredBrush" TileMode="Tile" Viewport="0,0,20,20" ViewportUnits="Absolute">
            <DrawingBrush.Drawing>
                <DrawingGroup>
                    <GeometryDrawing Brush="White">
                        <GeometryDrawing.Geometry>
                            <RectangleGeometry Rect="0,0,20,20" />
                        </GeometryDrawing.Geometry>
                    </GeometryDrawing>
                    <GeometryDrawing Brush="#E0E0E0">
                        <GeometryDrawing.Geometry>
                            <GeometryGroup>
                                <RectangleGeometry Rect="0,0,10,10" />
                                <RectangleGeometry Rect="10,10,10,10" />
                            </GeometryGroup>
                        </GeometryDrawing.Geometry>
                    </GeometryDrawing>
                </DrawingGroup>
            </DrawingBrush.Drawing>
        </DrawingBrush>
    </Window.Resources>

    <DockPanel>
        <!-- 工具栏 -->
        <Border DockPanel.Dock="Top" Background="#333" Padding="10">
            <StackPanel Orientation="Horizontal">
                <Button Content=" 1. 加载遮罩(PNG) " Click="LoadMask_Click" Height="30" Margin="5" HorizontalAlignment="Stretch"/>
                <Button Content=" 2. 加载图片 " Click="LoadImage_Click" Margin="5" HorizontalAlignment="Stretch"/>
                <ComboBox Width="80" Margin="5" SelectionChanged="BgColor_SelectionChanged" VerticalAlignment="Center">
                    <ComboBoxItem Content="白色背景" Tag="White" IsSelected="True"/>
                    <ComboBoxItem Content="灰色背景" Tag="#F0F0F0"/>
                    <ComboBoxItem Content="棋盘格" Tag="Checkered"/>
                </ComboBox>
                <TextBlock Text="预览缩放:" VerticalAlignment="Center" Foreground="White" Margin="10"/>
                <Slider x:Name="ZoomSlider" Minimum="0.1" Maximum="2" Value="0.5" Width="200" Margin="10,0" VerticalAlignment="Center"/>
                <TextBlock Text="{Binding Value, ElementName=ZoomSlider, StringFormat={}{0:P0}}" VerticalAlignment="Center" Foreground="White"/>
                
                <Rectangle Width="1" Fill="White" Margin="10,0"/>
                <Button Content="  保存结果  " Click="SaveResult_Click" HorizontalAlignment="Stretch" Background="#2D7D46" Foreground="White" Margin="10,0"/>
                <CheckBox x:Name="ExSaveBox" Content="额外保存一半大小的图片" ToolTip="勾选后，会生成两个文件：原始尺寸的_p.png和缩小一半的.png" IsChecked="True" Foreground="White" VerticalAlignment="Center"/>
            </StackPanel>
        </Border>

        <ScrollViewer x:Name="MainScrollViewer" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
            <!-- 画布 -->
            <Grid x:Name="MainCanvas" Background="White" HorizontalAlignment="Center" VerticalAlignment="Center">
                <Grid.LayoutTransform>
                    <ScaleTransform ScaleX="{Binding Value, ElementName=ZoomSlider}" ScaleY="{Binding Value, ElementName=ZoomSlider}"/>
                </Grid.LayoutTransform>

                <!-- 图片层 -->
                <Canvas x:Name="ImageLayer" Background="Transparent">
                    <Image x:Name="TargetImage" Stretch="None" RenderTransformOrigin="0.5,0.5">
                        <Image.RenderTransform>
                            <TransformGroup>
                                <ScaleTransform x:Name="imgScale" />
                                <RotateTransform x:Name="imgRotate" />
                                <TranslateTransform x:Name="imgTranslate" />
                            </TransformGroup>
                        </Image.RenderTransform>
                    </Image>
                </Canvas>

                <!-- 遮罩层 -->
                <Canvas x:Name="MaskCanvas" IsHitTestVisible="False">
                    <!-- 遮罩效果 -->
                    <Image x:Name="MaskOverlayImage" Opacity="1" Stretch="None" />
                    <!-- 辅助红框 -->
                    <Border x:Name="ExportGuide" BorderBrush="Red" BorderThickness="2" Visibility="Collapsed"/>
                </Canvas>
            </Grid>
        </ScrollViewer>
    </DockPanel>
</Window>